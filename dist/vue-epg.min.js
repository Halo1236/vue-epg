var VueEpg=function(t,e,i,n,s,r,a,o,u,h){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n,s=s&&s.hasOwnProperty("default")?s.default:s,r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a,o=o&&o.hasOwnProperty("default")?o.default:o,u=u&&u.hasOwnProperty("default")?u.default:u;var l=function(){function t(){e(this,t)}return i(t,[{key:"infos",value:function(t){var e;try{e=t.getBoundingClientRect()}catch(e){return console.log("no bounding",t),!1}return{left:e.left,right:e.left+e.width,up:e.top,down:e.top+e.height,x:e.x,y:e.y}}},{key:"distance",value:function(t,e,i,n){return parseInt(Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2)))}},{key:"contains",value:function(t,e,i,n){return e-t+(n-i)>=Math.max(t,e,i,n)-Math.min(t,e,i,n)}},{key:"rules",value:function(t,e,i,n,s){var r,a,o;return"up"===s?t.up>=e.down&&(r=this.distance(e.left,e.up,t.left,t.up),(!n||r<n)&&(n=r,o=!0),(!i||this.contains(e.left,e.right,t.left,t.right)&&r<i)&&(i=r,a=!0)):"down"===s?t.down<=e.up&&(r=this.distance(e.left,e.up,t.left,t.up),(!n||r<n)&&(n=r,o=!0),(!i||this.contains(e.left,e.right,t.left,t.right)&&r<i)&&(i=r,a=!0)):"left"===s?t.left>=e.right&&(r=this.distance(e.left,e.up,t.left,t.up),(!n||r<n)&&(n=r,o=!0),(!i||this.contains(e.up,e.down,t.up,t.down)&&r<i)&&(i=r,a=!0)):"right"===s&&t.right<=e.left&&(r=this.distance(e.left,e.up,t.left,t.up),(!n||r<n)&&(n=r,o=!0),(!i||this.contains(e.up,e.down,t.up,t.down)&&r<i)&&(i=r,a=!0)),{pDvalue:i,mDvalue:n,pref:a,min:o}}},{key:"hasClass",value:function(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}},{key:"addClass",value:function(t,e){this.hasClass(t,e)||(t.className+=" "+e)}},{key:"removeClass",value:function(t,e){this.hasClass(t,e)&&(t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," "))}}]),t}(),c=function(){function t(i){e(this,t);var n={focus_class:"focus",back:this.back,group_name:".group"},s=o(n,i);this.options=s,this.focus_class=s.focus_class,this.back=s.back,this.caculate=new l,this.pointer=null,this.group=null,this.keyActions={UP:[87],DOWN:[83,40],LEFT:[65],RIGHT:[68],ENTER:[13],BACK:[4,27]},this.items=[],this.groups=[],this.actions=i.actions||[],this.listeners=[],this.handlers={},i.setKeyBoardEventListener?i.setKeyBoardEventListener(this):this.setKeyBoardEventListener()}return i(t,[{key:"getItems",value:function(){return this.items}},{key:"getEleByPath",value:function(t){return h.find(t)}},{key:"getElementByPathSync",value:function(){function t(t){return e.apply(this,arguments)}var e=a(r.mark(function t(e){return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,this.getpath(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)}));return t}()},{key:"path",value:function(t){return new s(function(e,i){setTimeout(function(){var n=h.find(t);if(!n)return i(t);e(n)},500)})}},{key:"getpath",value:function(t){var e=this;return new s(function(i,n){var s=e,r=0;!function e(){if(r>=2)return i(s.pointer.$el),!1;r++,s.path(t).then(function(t){i(t)}).catch(function(t){e(t)})}()})}},{key:"getPointerPosition",value:function(){return{xpath:h.getXPath(this.pointer.$el)}}},{key:"enter",value:function(){}},{key:"onback",value:function(){}},{key:"back",value:function(){this.onback&&this.onback()}},{key:"focus",value:function(t){}},{key:"getFoucsClass",value:function(){return this.pointer.focus_class||this.focus_class}},{key:"left",value:function(){this.move("left")}},{key:"right",value:function(){this.move("right")}},{key:"up",value:function(){this.move("up")}},{key:"down",value:function(){this.move("down")}},{key:"move",value:function(){function t(t){return e.apply(this,arguments)}var e=a(r.mark(function t(e){var i,s,a,o=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.items.length){t.next=2;break}return t.abrupt("return");case 2:if(!this.pointer&&(this.pointer=this.items[0]),i=void 0,s=void 0,a=void 0===e?"undefined":n(e),!e&&(e=this.pointer),"object"!==a){t.next=19;break}if(!e.$el){t.next=10;break}e=e.$el,t.next=19;break;case 10:if(!e.nodeType){t.next=13;break}t.next=19;break;case 13:return t.next=15,e;case 15:if(!t.sent){t.next=19;break}return t.next=18,e;case 18:e=t.sent;case 19:if("object"===a&&e.nodeType?i=e.dataset?this.items.filter(function(t){return t.id===e.dataset.id})[0]:this.items.filter(function(t){return t.id===e.attributes.id})[0]:/up|down|right|left/gi.test(e)&&(i=this.pointer&&this.next(e)),!i){t.next=36;break}if(this.setGroup(),u(i.$el).parents(this.options.group_name).length&&(s=this.groups.filter(function(t){return t.$el.dataset?t.groupId===u(i.$el).parents(o.options.group_name)[0].dataset.groupId:t.groupId===u(i.$el).parents(o.options.group_name)[0].attributes.groupId})[0]),!/up|down|right|left/gi.test(e)){t.next=27;break}if(this.group===s||!this.group){t.next=27;break}if(!this.group.listener[e]){t.next=27;break}return t.abrupt("return",this.group.listener[e]());case 27:this.pointer&&(this.pointer.isFocus=!1,u(this.pointer.$el).removeClass(this.getFoucsClass()),this.pointer.listener.blur&&this.pointer.listener.blur()),this.listeners.indexOf("move")>-1&&this.emit({type:"move",target:{direction:e,next:i}}),this.pointer=i,this.setGroup(),this.pointer.isFocus=!0,u(this.pointer.$el).addClass(this.getFoucsClass()),this.pointer.listener.focus&&this.pointer.listener.focus(),t.next=40;break;case 36:if(!/up|down|right|left/gi.test(e)){t.next=40;break}if(!this.group){t.next=40;break}if(!this.group.listener[e]){t.next=40;break}return t.abrupt("return",this.group.listener[e]());case 40:case"end":return t.stop()}},t,this)}));return t}()},{key:"next",value:function(t){var e=this,i=this.pointer,n=this.caculate.infos(this.pointer.$el),s=void 0,r=void 0,a=void 0,o=void 0,h=void 0;return this.items.forEach(function(l){if(l!==i){s=e.caculate.infos(l.$el,t);var c=u(l.$el).offset();if(c.left<-100||c.top<-100)return;var p=e.caculate.rules(n,s,r,a,t);r=p.pDvalue,a=p.mDvalue,p.pref&&(o=l),p.min&&(h=l)}}),"left"===t||"right"===t?o:"up"===t||"down"===t?o||h:void 0}},{key:"setGroup",value:function(){var t=this;return!this.pointer&&(this.pointer=this.items[0]),u(this.pointer.$el).parents(this.options.group_name).length?this.group=this.groups.filter(function(e){return e.$el.dataset?e.groupId===u(t.pointer.$el).parents(t.options.group_name)[0].dataset.groupId:e.groupId===u(t.pointer.$el).parents(t.options.group_name)[0].attributes.groupId})[0]:this.group=!1,!1}},{key:"setKeyBoardEventListener",value:function(){var t=this;document.onkeydown=document.onsystemevent=document.onirkeypress=document.onkeypress=function(e){var i,n,s,r,a,o,u=e.which?e.which:e.keyCode;e.stopPropagation(),e.preventDefault(),(i=t.keyActions.UP).push.apply(i,[19,38]),(n=t.keyActions.DOWN).push.apply(n,[20,47,40]),(s=t.keyActions.LEFT).push.apply(s,[29,21,37]),(r=t.keyActions.RIGHT).push.apply(r,[22,32,39]),(a=t.keyActions.ENTER).push.apply(a,[73,66,23,13,1]),(o=t.keyActions.BACK).push.apply(o,[4,27,8]),t.keyActions.PAGEACTION=[33,34],t.keyActions.NUMBER=[49,50,51,52,53,54,55,56,57,48,96,97,98,99,100,101,102,103,104,105],t.keyActions.VOLUME=[259,260],t.keyActions.TOGGLE=[263],t.eventHandler(u)}}},{key:"eventHandler",value:function(t){this.items.length||!this.pointer&&(this.pointer=this.items[0]);var e=null;for(var i in this.keyActions)if(-1!==this.keyActions[i].indexOf(t)){e=i;break}if(e){if(this.pointer)switch(e){case"ENTER":this.pointer.listener.click&&this.pointer.listener.click();break;case"DOWN":this.pointer.listener.down?this.pointer.listener.down(this.pointer,this.down):this.down();break;case"UP":this.pointer.listener.up?this.pointer.listener.up(this.pointer,this.up):this.up();break;case"LEFT":this.pointer.listener.left?this.pointer.listener.left(this.pointer,this.left):this.left();break;case"RIGHT":this.pointer.listener.right?this.pointer.listener.right(this.pointer,this.right):this.right()}"BACK"===e&&this.back(),this.actions.includes(e.toLowerCase())&&(console.log(this.actions[e.toLowerCase()],t),this.actions&&"function"==typeof this.actions[e.toLowerCase()]&&this.actions[e.toLowerCase()](t))}}},{key:"registerGroup",value:function(t){this.groups.push(t)}},{key:"updateGroup",value:function(t){this.groups.forEach(function(e){t.groupId===e.groupId&&o(e,t)})}},{key:"registerItem",value:function(t){this.items.push(t),t.isDefault&&(this.pointer=t)}},{key:"updateItem",value:function(t){this.items.forEach(function(e){e.id===t.id&&o(e,t)})}},{key:"clear",value:function(){this.pointer=!1,this.groups=[],this.items=[],this.onback=null}},{key:"on",value:function(t,e){return void 0===this.handlers[t]&&(this.handlers[t]=[]),this.listeners.push(t),this.handlers[t].push(e),this}},{key:"off",value:function(t,e){if(this.handlers[t]instanceof Array){for(var i=this.handlers[t],n=0,s=i.length;n<s&&i[n]!==e;n++);return this.listeners.splice(n,1),i.splice(n,1),this}}},{key:"emit",value:function(t){if(t.target||(t.target=this),this.handlers[t.type]instanceof Array)for(var e=this.handlers[t.type],i=0,n=e.length;i<n;i++)return e[i](t),!0;return!1}}]),t}(),p=function t(i,n){var s=this;e(this,t);var r=i.elm,a="focus-el-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10);r.dataset?r.dataset.id||(r.dataset.id=a):r.attributes.id||(r.attributes.id=a),this.data={},this.$el=r,this.id=a,this.isDefault=!(!n.value||!n.value.default),this.isFocus=!1,this.listener={click:!1,focus:!1,blur:!1,left:!1,right:!1,up:!1,down:!1},n.value&&n.value.class&&n.value.class&&(this.focus_class=n.value.class),i.data.attrs&&(this.data=i.data.attrs),i.data.on&&["click","focus","blur","left","right","up","down"].forEach(function(t){i.data.on.hasOwnProperty(t)&&(s.listener[t]=i.data.on[t])})},f=function t(i,n,s){var r=this;e(this,t);var a=o({group_name:"group"},s);this.group_class=a.group_name;var h=i.elm;u(h).addClass(this.group_class);var l="group-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10);h.dataset?h.dataset.groupId||(h.dataset.groupId=l):h.attributes.groupId||(h.attributes.groupId=l),this.groupId=l,this.listener={},this.$el=h,i.data.on&&["left","right","up","down"].forEach(function(t){i.data.on.hasOwnProperty(t)&&(r.listener[t]=i.data.on[t])})};console.log("iptv-epg is loaded");"undefined"!=typeof window?window.Vue:"undefined"!=typeof global&&global.Vue;var d=function(){function t(i){e(this,t),this.epgService||(this.epgService=new c(i))}return i(t,[{key:"getService",value:function(){return this.epgService}},{key:"install",value:function(t){t.prototype.$service=this.epgService;var e=this.epgService;t.directive("group",{bind:function(t,i,n){var s=new f(n,i);e.registerGroup(s)},componentUpdated:function(t,i,n){var s=new f(n,i);e.updateGroup(s)},unbind:function(t,i,n){e.groups.forEach(function(i,n){i.groupId===t.dataset.groupId&&e.groups.splice(n,1)})}}),t.directive("items",{bind:function(t,i,n){var s=new p(n,i);e.registerItem(s)},componentUpdated:function(t,i,n){var s=new p(n,i);e.updateItem(s)},unbind:function(t,i,n){e.items.forEach(function(i,n){i.id===t.dataset.id&&e.items.splice(n,1)})}}),t.mixin({mounted:function(){this.serviceBack&&(this.$service.onback=this.serviceBack)}})}}]),t}();return t.default=d,t}({},_classCallCheck,_createClass,_typeof,_Promise,_regeneratorRuntime,_asyncToGenerator,_Object$assign,$,xpathDom);
